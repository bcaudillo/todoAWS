{"ast":null,"code":"import { __assign, __awaiter, __extends, __generator, __spreadArray } from \"tslib\";\nimport { resolveAliasArguments, resolveArguments, resolvePageArguments, resolveUserArguments } from '../arguments-resolver';\nimport { isOffline } from '../connection';\nimport { Context } from '../context';\nimport { dispatch } from '@segment/analytics-core';\nimport { Emitter } from '@segment/analytics-generic-utils';\nimport { EventFactory } from '../events';\nimport { isDestinationPluginWithAddMiddleware } from '../plugin';\nimport { EventQueue } from '../queue/event-queue';\nimport { Group, User } from '../user';\nimport autoBind from '../../lib/bind-all';\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted';\nimport { version } from '../../generated/version';\nimport { PriorityQueue } from '../../lib/priority-queue';\nimport { getGlobal } from '../../lib/get-global';\nimport { MemoryStorage, UniversalStorage, StoreType, applyCookieOptions, initializeStorages, isArrayOfStoreType } from '../storage';\nimport { setGlobalAnalytics } from '../../lib/global-analytics-helper';\nimport { popPageContext } from '../buffer';\nvar deprecationWarning = 'This is being deprecated and will be not be available in future releases of Analytics JS';\n// reference any pre-existing \"analytics\" object so a user can restore the reference\nvar global = getGlobal();\nvar _analytics = global === null || global === void 0 ? void 0 : global.analytics;\nfunction createDefaultQueue(name, retryQueue, disablePersistance) {\n  if (retryQueue === void 0) {\n    retryQueue = false;\n  }\n  if (disablePersistance === void 0) {\n    disablePersistance = false;\n  }\n  var maxAttempts = retryQueue ? 10 : 1;\n  var priorityQueue = disablePersistance ? new PriorityQueue(maxAttempts, []) : new PersistedPriorityQueue(maxAttempts, name);\n  return new EventQueue(priorityQueue);\n}\n/* analytics-classic stubs */\nfunction _stub() {\n  console.warn(deprecationWarning);\n}\nvar Analytics = /** @class */function (_super) {\n  __extends(Analytics, _super);\n  function Analytics(settings, options, queue, user, group) {\n    var _this = this;\n    var _a, _b, _c;\n    _this = _super.call(this) || this;\n    _this._debug = false;\n    _this.initialized = false;\n    _this.user = function () {\n      return _this._user;\n    };\n    _this.init = _this.initialize.bind(_this);\n    _this.log = _stub;\n    _this.addIntegrationMiddleware = _stub;\n    _this.listeners = _stub;\n    _this.addEventListener = _stub;\n    _this.removeAllListeners = _stub;\n    _this.removeListener = _stub;\n    _this.removeEventListener = _stub;\n    _this.hasListeners = _stub;\n    _this.add = _stub;\n    _this.addIntegration = _stub;\n    var cookieOptions = options === null || options === void 0 ? void 0 : options.cookie;\n    var disablePersistance = (_a = options === null || options === void 0 ? void 0 : options.disableClientPersistence) !== null && _a !== void 0 ? _a : false;\n    _this.settings = settings;\n    _this.settings.timeout = (_b = _this.settings.timeout) !== null && _b !== void 0 ? _b : 300;\n    _this.queue = queue !== null && queue !== void 0 ? queue : createDefaultQueue(\"\".concat(settings.writeKey, \":event-queue\"), options === null || options === void 0 ? void 0 : options.retryQueue, disablePersistance);\n    var storageSetting = options === null || options === void 0 ? void 0 : options.storage;\n    _this._universalStorage = _this.createStore(disablePersistance, storageSetting, cookieOptions);\n    _this._user = user !== null && user !== void 0 ? user : new User(__assign({\n      persist: !disablePersistance,\n      storage: options === null || options === void 0 ? void 0 : options.storage\n    }, options === null || options === void 0 ? void 0 : options.user), cookieOptions).load();\n    _this._group = group !== null && group !== void 0 ? group : new Group(__assign({\n      persist: !disablePersistance,\n      storage: options === null || options === void 0 ? void 0 : options.storage\n    }, options === null || options === void 0 ? void 0 : options.group), cookieOptions).load();\n    _this.eventFactory = new EventFactory(_this._user);\n    _this.integrations = (_c = options === null || options === void 0 ? void 0 : options.integrations) !== null && _c !== void 0 ? _c : {};\n    _this.options = options !== null && options !== void 0 ? options : {};\n    autoBind(_this);\n    return _this;\n  }\n  /**\n   * Creates the storage system based on the settings received\n   * @returns Storage\n   */\n  Analytics.prototype.createStore = function (disablePersistance, storageSetting, cookieOptions) {\n    // DisablePersistance option overrides all, no storage will be used outside of memory even if specified\n    if (disablePersistance) {\n      return new UniversalStorage([new MemoryStorage()]);\n    } else {\n      if (storageSetting) {\n        if (isArrayOfStoreType(storageSetting)) {\n          // We will create the store with the priority for customer settings\n          return new UniversalStorage(initializeStorages(applyCookieOptions(storageSetting.stores, cookieOptions)));\n        }\n      }\n    }\n    // We default to our multi storage with priority\n    return new UniversalStorage(initializeStorages([StoreType.LocalStorage, {\n      name: StoreType.Cookie,\n      settings: cookieOptions\n    }, StoreType.Memory]));\n  };\n  Object.defineProperty(Analytics.prototype, \"storage\", {\n    get: function () {\n      return this._universalStorage;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Analytics.prototype.track = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var pageCtx, _a, name, data, opts, cb, segmentEvent;\n      var _this = this;\n      return __generator(this, function (_b) {\n        pageCtx = popPageContext(args);\n        _a = resolveArguments.apply(void 0, args), name = _a[0], data = _a[1], opts = _a[2], cb = _a[3];\n        segmentEvent = this.eventFactory.track(name, data, opts, this.integrations, pageCtx);\n        return [2 /*return*/, this._dispatch(segmentEvent, cb).then(function (ctx) {\n          _this.emit('track', name, ctx.event.properties, ctx.event.options);\n          return ctx;\n        })];\n      });\n    });\n  };\n  Analytics.prototype.page = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var pageCtx, _a, category, page, properties, options, callback, segmentEvent;\n      var _this = this;\n      return __generator(this, function (_b) {\n        pageCtx = popPageContext(args);\n        _a = resolvePageArguments.apply(void 0, args), category = _a[0], page = _a[1], properties = _a[2], options = _a[3], callback = _a[4];\n        segmentEvent = this.eventFactory.page(category, page, properties, options, this.integrations, pageCtx);\n        return [2 /*return*/, this._dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('page', category, page, ctx.event.properties, ctx.event.options);\n          return ctx;\n        })];\n      });\n    });\n  };\n  Analytics.prototype.identify = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var pageCtx, _a, id, _traits, options, callback, segmentEvent;\n      var _this = this;\n      return __generator(this, function (_b) {\n        pageCtx = popPageContext(args);\n        _a = resolveUserArguments(this._user).apply(void 0, args), id = _a[0], _traits = _a[1], options = _a[2], callback = _a[3];\n        this._user.identify(id, _traits);\n        segmentEvent = this.eventFactory.identify(this._user.id(), this._user.traits(), options, this.integrations, pageCtx);\n        return [2 /*return*/, this._dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('identify', ctx.event.userId, ctx.event.traits, ctx.event.options);\n          return ctx;\n        })];\n      });\n    });\n  };\n  Analytics.prototype.group = function () {\n    var _this = this;\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    var pageCtx = popPageContext(args);\n    if (args.length === 0) {\n      return this._group;\n    }\n    var _a = resolveUserArguments(this._group).apply(void 0, args),\n      id = _a[0],\n      _traits = _a[1],\n      options = _a[2],\n      callback = _a[3];\n    this._group.identify(id, _traits);\n    var groupId = this._group.id();\n    var groupTraits = this._group.traits();\n    var segmentEvent = this.eventFactory.group(groupId, groupTraits, options, this.integrations, pageCtx);\n    return this._dispatch(segmentEvent, callback).then(function (ctx) {\n      _this.emit('group', ctx.event.groupId, ctx.event.traits, ctx.event.options);\n      return ctx;\n    });\n  };\n  Analytics.prototype.alias = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var pageCtx, _a, to, from, options, callback, segmentEvent;\n      var _this = this;\n      return __generator(this, function (_b) {\n        pageCtx = popPageContext(args);\n        _a = resolveAliasArguments.apply(void 0, args), to = _a[0], from = _a[1], options = _a[2], callback = _a[3];\n        segmentEvent = this.eventFactory.alias(to, from, options, this.integrations, pageCtx);\n        return [2 /*return*/, this._dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('alias', to, from, ctx.event.options);\n          return ctx;\n        })];\n      });\n    });\n  };\n  Analytics.prototype.screen = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var pageCtx, _a, category, page, properties, options, callback, segmentEvent;\n      var _this = this;\n      return __generator(this, function (_b) {\n        pageCtx = popPageContext(args);\n        _a = resolvePageArguments.apply(void 0, args), category = _a[0], page = _a[1], properties = _a[2], options = _a[3], callback = _a[4];\n        segmentEvent = this.eventFactory.screen(category, page, properties, options, this.integrations, pageCtx);\n        return [2 /*return*/, this._dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('screen', category, page, ctx.event.properties, ctx.event.options);\n          return ctx;\n        })];\n      });\n    });\n  };\n  Analytics.prototype.trackClick = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n      var _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, import( /* webpackChunkName: \"auto-track\" */'../auto-track')];\n          case 1:\n            autotrack = _b.sent();\n            return [2 /*return*/, (_a = autotrack.link).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n  Analytics.prototype.trackLink = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n      var _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, import( /* webpackChunkName: \"auto-track\" */'../auto-track')];\n          case 1:\n            autotrack = _b.sent();\n            return [2 /*return*/, (_a = autotrack.link).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n  Analytics.prototype.trackSubmit = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n      var _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, import( /* webpackChunkName: \"auto-track\" */'../auto-track')];\n          case 1:\n            autotrack = _b.sent();\n            return [2 /*return*/, (_a = autotrack.form).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n  Analytics.prototype.trackForm = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n      var _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, import( /* webpackChunkName: \"auto-track\" */'../auto-track')];\n          case 1:\n            autotrack = _b.sent();\n            return [2 /*return*/, (_a = autotrack.form).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n  Analytics.prototype.register = function () {\n    var plugins = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      plugins[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var ctx, registrations;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            ctx = Context.system();\n            registrations = plugins.map(function (xt) {\n              return _this.queue.register(ctx, xt, _this);\n            });\n            return [4 /*yield*/, Promise.all(registrations)];\n          case 1:\n            _a.sent();\n            return [2 /*return*/, ctx];\n        }\n      });\n    });\n  };\n  Analytics.prototype.deregister = function () {\n    var plugins = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      plugins[_i] = arguments[_i];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var ctx, deregistrations;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            ctx = Context.system();\n            deregistrations = plugins.map(function (pl) {\n              var plugin = _this.queue.plugins.find(function (p) {\n                return p.name === pl;\n              });\n              if (plugin) {\n                return _this.queue.deregister(ctx, plugin, _this);\n              } else {\n                ctx.log('warn', \"plugin \".concat(pl, \" not found\"));\n              }\n            });\n            return [4 /*yield*/, Promise.all(deregistrations)];\n          case 1:\n            _a.sent();\n            return [2 /*return*/, ctx];\n        }\n      });\n    });\n  };\n  Analytics.prototype.debug = function (toggle) {\n    // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n    if (toggle === false && localStorage.getItem('debug')) {\n      localStorage.removeItem('debug');\n    }\n    this._debug = toggle;\n    return this;\n  };\n  Analytics.prototype.reset = function () {\n    this._user.reset();\n    this._group.reset();\n    this.emit('reset');\n  };\n  Analytics.prototype.timeout = function (timeout) {\n    this.settings.timeout = timeout;\n  };\n  Analytics.prototype._dispatch = function (event, callback) {\n    return __awaiter(this, void 0, void 0, function () {\n      var ctx;\n      return __generator(this, function (_a) {\n        ctx = new Context(event);\n        if (isOffline() && !this.options.retryQueue) {\n          return [2 /*return*/, ctx];\n        }\n        return [2 /*return*/, dispatch(ctx, this.queue, this, {\n          callback: callback,\n          debug: this._debug,\n          timeout: this.settings.timeout\n        })];\n      });\n    });\n  };\n  Analytics.prototype.addSourceMiddleware = function (fn) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.queue.criticalTasks.run(function () {\n              return __awaiter(_this, void 0, void 0, function () {\n                var sourceMiddlewarePlugin, integrations, plugin;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4 /*yield*/, import( /* webpackChunkName: \"middleware\" */'../../plugins/middleware')];\n                    case 1:\n                      sourceMiddlewarePlugin = _a.sent().sourceMiddlewarePlugin;\n                      integrations = {};\n                      this.queue.plugins.forEach(function (plugin) {\n                        if (plugin.type === 'destination') {\n                          return integrations[plugin.name] = true;\n                        }\n                      });\n                      plugin = sourceMiddlewarePlugin(fn, integrations);\n                      return [4 /*yield*/, this.register(plugin)];\n                    case 2:\n                      _a.sent();\n                      return [2 /*return*/];\n                  }\n                });\n              });\n            })];\n          case 1:\n            _a.sent();\n            return [2 /*return*/, this];\n        }\n      });\n    });\n  };\n  /* TODO: This does not have to return a promise? */\n  Analytics.prototype.addDestinationMiddleware = function (integrationName) {\n    var middlewares = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n      middlewares[_i - 1] = arguments[_i];\n    }\n    this.queue.plugins.filter(isDestinationPluginWithAddMiddleware).forEach(function (p) {\n      if (integrationName === '*' || p.name.toLowerCase() === integrationName.toLowerCase()) {\n        p.addMiddleware.apply(p, middlewares);\n      }\n    });\n    return Promise.resolve(this);\n  };\n  Analytics.prototype.setAnonymousId = function (id) {\n    return this._user.anonymousId(id);\n  };\n  Analytics.prototype.queryString = function (query) {\n    return __awaiter(this, void 0, void 0, function () {\n      var queryString;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (this.options.useQueryString === false) {\n              return [2 /*return*/, []];\n            }\n            return [4 /*yield*/, import( /* webpackChunkName: \"queryString\" */'../query-string')];\n          case 1:\n            queryString = _a.sent().queryString;\n            return [2 /*return*/, queryString(this, query)];\n        }\n      });\n    });\n  };\n  /**\n   * @deprecated This function does not register a destination plugin.\n   *\n   * Instantiates a legacy Analytics.js destination.\n   *\n   * This function does not register the destination as an Analytics.JS plugin,\n   * all the it does it to invoke the factory function back.\n   */\n  Analytics.prototype.use = function (legacyPluginFactory) {\n    legacyPluginFactory(this);\n    return this;\n  };\n  Analytics.prototype.ready = function (callback) {\n    if (callback === void 0) {\n      callback = function (res) {\n        return res;\n      };\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, Promise.all(this.queue.plugins.map(function (i) {\n          return i.ready ? i.ready() : Promise.resolve();\n        })).then(function (res) {\n          callback(res);\n          return res;\n        })];\n      });\n    });\n  };\n  // analytics-classic api\n  Analytics.prototype.noConflict = function () {\n    console.warn(deprecationWarning);\n    setGlobalAnalytics(_analytics !== null && _analytics !== void 0 ? _analytics : this);\n    return this;\n  };\n  Analytics.prototype.normalize = function (msg) {\n    console.warn(deprecationWarning);\n    return this.eventFactory.normalize(msg);\n  };\n  Object.defineProperty(Analytics.prototype, \"failedInitializations\", {\n    get: function () {\n      console.warn(deprecationWarning);\n      return this.queue.failedInitializations;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Analytics.prototype, \"VERSION\", {\n    get: function () {\n      return version;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /* @deprecated - noop */\n  Analytics.prototype.initialize = function (_settings, _options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        console.warn(deprecationWarning);\n        return [2 /*return*/, Promise.resolve(this)];\n      });\n    });\n  };\n  Analytics.prototype.pageview = function (url) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            console.warn(deprecationWarning);\n            return [4 /*yield*/, this.page({\n              path: url\n            })];\n          case 1:\n            _a.sent();\n            return [2 /*return*/, this];\n        }\n      });\n    });\n  };\n  Object.defineProperty(Analytics.prototype, \"plugins\", {\n    get: function () {\n      var _a;\n      console.warn(deprecationWarning);\n      // @ts-expect-error\n      return (_a = this._plugins) !== null && _a !== void 0 ? _a : {};\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Analytics.prototype, \"Integrations\", {\n    get: function () {\n      console.warn(deprecationWarning);\n      var integrations = this.queue.plugins.filter(function (plugin) {\n        return plugin.type === 'destination';\n      }).reduce(function (acc, plugin) {\n        var name = \"\".concat(plugin.name.toLowerCase().replace('.', '').split(' ').join('-'), \"Integration\");\n        // @ts-expect-error\n        var integration = window[name];\n        if (!integration) {\n          return acc;\n        }\n        var nested = integration.Integration; // hack - Google Analytics function resides in the \"Integration\" field\n        if (nested) {\n          acc[plugin.name] = nested;\n          return acc;\n        }\n        acc[plugin.name] = integration;\n        return acc;\n      }, {});\n      return integrations;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  // snippet function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  Analytics.prototype.push = function (args) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var an = this;\n    var method = args.shift();\n    if (method) {\n      if (!an[method]) return;\n    }\n    an[method].apply(this, args);\n  };\n  return Analytics;\n}(Emitter);\nexport { Analytics };\n/**\n * @returns a no-op analytics instance that does not create cookies or localstorage, or send any events to segment.\n */\nvar NullAnalytics = /** @class */function (_super) {\n  __extends(NullAnalytics, _super);\n  function NullAnalytics() {\n    var _this = _super.call(this, {\n      writeKey: ''\n    }, {\n      disableClientPersistence: true\n    }) || this;\n    _this.initialized = true;\n    return _this;\n  }\n  return NullAnalytics;\n}(Analytics);\nexport { NullAnalytics };","map":{"version":3,"names":["resolveAliasArguments","resolveArguments","resolvePageArguments","resolveUserArguments","isOffline","Context","dispatch","Emitter","EventFactory","isDestinationPluginWithAddMiddleware","EventQueue","Group","User","autoBind","PersistedPriorityQueue","version","PriorityQueue","getGlobal","MemoryStorage","UniversalStorage","StoreType","applyCookieOptions","initializeStorages","isArrayOfStoreType","setGlobalAnalytics","popPageContext","deprecationWarning","global","_analytics","analytics","createDefaultQueue","name","retryQueue","disablePersistance","maxAttempts","priorityQueue","_stub","console","warn","Analytics","_super","__extends","settings","options","queue","user","group","_this","call","_debug","initialized","_user","init","initialize","bind","log","addIntegrationMiddleware","listeners","addEventListener","removeAllListeners","removeListener","removeEventListener","hasListeners","add","addIntegration","cookieOptions","cookie","_a","disableClientPersistence","timeout","_b","concat","writeKey","storageSetting","storage","_universalStorage","createStore","__assign","persist","load","_group","eventFactory","integrations","_c","prototype","stores","LocalStorage","Cookie","Memory","Object","defineProperty","get","track","args","_i","arguments","length","pageCtx","apply","data","opts","cb","segmentEvent","_dispatch","then","ctx","emit","event","properties","page","category","callback","identify","id","_traits","traits","userId","groupId","groupTraits","alias","to","from","screen","trackClick","autotrack","sent","link","__spreadArray","trackLink","trackSubmit","form","trackForm","register","plugins","system","registrations","map","xt","Promise","all","deregister","deregistrations","pl","plugin","find","p","debug","toggle","localStorage","getItem","removeItem","reset","addSourceMiddleware","fn","criticalTasks","run","__awaiter","sourceMiddlewarePlugin","forEach","type","addDestinationMiddleware","integrationName","middlewares","filter","toLowerCase","addMiddleware","resolve","setAnonymousId","anonymousId","queryString","query","useQueryString","use","legacyPluginFactory","ready","res","i","noConflict","normalize","msg","failedInitializations","_settings","_options","pageview","url","path","_plugins","reduce","acc","replace","split","join","integration","window","nested","Integration","push","an","method","shift","NullAnalytics"],"sources":["/Users/bcaudillo/Desktop/Projects/todo/node_modules/@segment/analytics-next/src/core/analytics/index.ts"],"sourcesContent":["import {\n  AliasParams,\n  DispatchedEvent,\n  EventParams,\n  GroupParams,\n  PageParams,\n  resolveAliasArguments,\n  resolveArguments,\n  resolvePageArguments,\n  resolveUserArguments,\n  IdentifyParams,\n} from '../arguments-resolver'\nimport type { FormArgs, LinkArgs } from '../auto-track'\nimport { isOffline } from '../connection'\nimport { Context } from '../context'\nimport { dispatch } from '@segment/analytics-core'\nimport { Emitter } from '@segment/analytics-generic-utils'\nimport {\n  Callback,\n  EventFactory,\n  Integrations,\n  Plan,\n  EventProperties,\n  SegmentEvent,\n} from '../events'\nimport { isDestinationPluginWithAddMiddleware, Plugin } from '../plugin'\nimport { EventQueue } from '../queue/event-queue'\nimport { Group, ID, User, UserOptions } from '../user'\nimport autoBind from '../../lib/bind-all'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport type {\n  LegacyIntegration,\n  ClassicIntegrationSource,\n} from '../../plugins/ajs-destination/types'\nimport type {\n  DestinationMiddlewareFunction,\n  MiddlewareFunction,\n} from '../../plugins/middleware'\nimport { version } from '../../generated/version'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { getGlobal } from '../../lib/get-global'\nimport { AnalyticsClassic, AnalyticsCore } from './interfaces'\nimport { HighEntropyHint } from '../../lib/client-hints/interfaces'\nimport type { LegacySettings } from '../../browser'\nimport {\n  CookieOptions,\n  MemoryStorage,\n  UniversalStorage,\n  StorageSettings,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\nimport { PluginFactory } from '../../plugins/remote-loader'\nimport { setGlobalAnalytics } from '../../lib/global-analytics-helper'\nimport { popPageContext } from '../buffer'\n\nconst deprecationWarning =\n  'This is being deprecated and will be not be available in future releases of Analytics JS'\n\n// reference any pre-existing \"analytics\" object so a user can restore the reference\nconst global: any = getGlobal()\nconst _analytics = global?.analytics\n\nfunction createDefaultQueue(\n  name: string,\n  retryQueue = false,\n  disablePersistance = false\n) {\n  const maxAttempts = retryQueue ? 10 : 1\n  const priorityQueue = disablePersistance\n    ? new PriorityQueue(maxAttempts, [])\n    : new PersistedPriorityQueue(maxAttempts, name)\n  return new EventQueue(priorityQueue)\n}\n\nexport interface AnalyticsSettings {\n  writeKey: string\n  timeout?: number\n  plugins?: (Plugin | PluginFactory)[]\n  classicIntegrations?: ClassicIntegrationSource[]\n}\n\nexport interface InitOptions {\n  /**\n   * Disables storing any data on the client-side via cookies or localstorage.\n   * Defaults to `false`.\n   *\n   */\n  disableClientPersistence?: boolean\n  /**\n   * Disables automatically converting ISO string event properties into Dates.\n   * ISO string to Date conversions occur right before sending events to a classic device mode integration,\n   * after any destination middleware have been ran.\n   * Defaults to `false`.\n   */\n  disableAutoISOConversion?: boolean\n  initialPageview?: boolean\n  cookie?: CookieOptions\n  storage?: StorageSettings\n  user?: UserOptions\n  group?: UserOptions\n  integrations?: Integrations\n  plan?: Plan\n  retryQueue?: boolean\n  obfuscate?: boolean\n  /**\n   * This callback allows you to update/mutate CDN Settings.\n   * This is called directly after settings are fetched from the CDN.\n   */\n  updateCDNSettings?: (settings: LegacySettings) => LegacySettings\n  /**\n   * Disables or sets constraints on processing of query string parameters\n   */\n  useQueryString?:\n    | boolean\n    | {\n        aid?: RegExp\n        uid?: RegExp\n      }\n  /**\n   * Array of high entropy Client Hints to request. These may be rejected by the user agent - only required hints should be requested.\n   */\n  highEntropyValuesClientHints?: HighEntropyHint[]\n  /**\n   * When using the snippet, this is the key that points to the global analytics instance (e.g. window.analytics).\n   * default: analytics\n   */\n  globalAnalyticsKey?: string\n\n  /**\n   * Disable sending any data to Segment's servers. All emitted events and API calls (including .ready()), will be no-ops, and no cookies or localstorage will be used.\n   *\n   * @example\n   * ### Basic (Will not not fetch any CDN settings)\n   * ```ts\n   * disable: process.env.NODE_ENV === 'test'\n   * ```\n   *\n   * ### Advanced (Fetches CDN Settings. Do not use this unless you require CDN settings for some reason)\n   * ```ts\n   * disable: (cdnSettings) => cdnSettings.foo === 'bar'\n   * ```\n   */\n  disable?:\n    | boolean\n    | ((cdnSettings: LegacySettings) => boolean | Promise<boolean>)\n}\n\n/* analytics-classic stubs */\nfunction _stub(this: never) {\n  console.warn(deprecationWarning)\n}\n\nexport class Analytics\n  extends Emitter\n  implements AnalyticsCore, AnalyticsClassic\n{\n  protected settings: AnalyticsSettings\n  private _user: User\n  private _group: Group\n  private eventFactory: EventFactory\n  private _debug = false\n  private _universalStorage: UniversalStorage\n\n  initialized = false\n  integrations: Integrations\n  options: InitOptions\n  queue: EventQueue\n\n  constructor(\n    settings: AnalyticsSettings,\n    options?: InitOptions,\n    queue?: EventQueue,\n    user?: User,\n    group?: Group\n  ) {\n    super()\n    const cookieOptions = options?.cookie\n    const disablePersistance = options?.disableClientPersistence ?? false\n    this.settings = settings\n    this.settings.timeout = this.settings.timeout ?? 300\n    this.queue =\n      queue ??\n      createDefaultQueue(\n        `${settings.writeKey}:event-queue`,\n        options?.retryQueue,\n        disablePersistance\n      )\n\n    const storageSetting = options?.storage\n    this._universalStorage = this.createStore(\n      disablePersistance,\n      storageSetting,\n      cookieOptions\n    )\n\n    this._user =\n      user ??\n      new User(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any User specific options override everything else\n          ...options?.user,\n        },\n        cookieOptions\n      ).load()\n    this._group =\n      group ??\n      new Group(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any group specific options override everything else\n          ...options?.group,\n        },\n        cookieOptions\n      ).load()\n    this.eventFactory = new EventFactory(this._user)\n    this.integrations = options?.integrations ?? {}\n    this.options = options ?? {}\n    autoBind(this)\n  }\n\n  user = (): User => {\n    return this._user\n  }\n\n  /**\n   * Creates the storage system based on the settings received\n   * @returns Storage\n   */\n  private createStore(\n    disablePersistance: boolean,\n    storageSetting: InitOptions['storage'],\n    cookieOptions?: CookieOptions | undefined\n  ): UniversalStorage {\n    // DisablePersistance option overrides all, no storage will be used outside of memory even if specified\n    if (disablePersistance) {\n      return new UniversalStorage([new MemoryStorage()])\n    } else {\n      if (storageSetting) {\n        if (isArrayOfStoreType(storageSetting)) {\n          // We will create the store with the priority for customer settings\n          return new UniversalStorage(\n            initializeStorages(\n              applyCookieOptions(storageSetting.stores, cookieOptions)\n            )\n          )\n        }\n      }\n    }\n    // We default to our multi storage with priority\n    return new UniversalStorage(\n      initializeStorages([\n        StoreType.LocalStorage,\n        {\n          name: StoreType.Cookie,\n          settings: cookieOptions,\n        },\n        StoreType.Memory,\n      ])\n    )\n  }\n\n  get storage(): UniversalStorage {\n    return this._universalStorage\n  }\n\n  async track(...args: EventParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [name, data, opts, cb] = resolveArguments(...args)\n\n    const segmentEvent = this.eventFactory.track(\n      name,\n      data as EventProperties,\n      opts,\n      this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(segmentEvent, cb).then((ctx) => {\n      this.emit('track', name, ctx.event.properties, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async page(...args: PageParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [category, page, properties, options, callback] =\n      resolvePageArguments(...args)\n\n    const segmentEvent = this.eventFactory.page(\n      category,\n      page,\n      properties,\n      options,\n      this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit('page', category, page, ctx.event.properties, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async identify(...args: IdentifyParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [id, _traits, options, callback] = resolveUserArguments(this._user)(\n      ...args\n    )\n\n    this._user.identify(id, _traits)\n    const segmentEvent = this.eventFactory.identify(\n      this._user.id(),\n      this._user.traits(),\n      options,\n      this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit(\n        'identify',\n        ctx.event.userId,\n        ctx.event.traits,\n        ctx.event.options\n      )\n      return ctx\n    })\n  }\n\n  group(): Group\n  group(...args: GroupParams): Promise<DispatchedEvent>\n  group(...args: GroupParams): Promise<DispatchedEvent> | Group {\n    const pageCtx = popPageContext(args)\n    if (args.length === 0) {\n      return this._group\n    }\n\n    const [id, _traits, options, callback] = resolveUserArguments(this._group)(\n      ...args\n    )\n\n    this._group.identify(id, _traits)\n    const groupId = this._group.id()\n    const groupTraits = this._group.traits()\n\n    const segmentEvent = this.eventFactory.group(\n      groupId,\n      groupTraits,\n      options,\n      this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit('group', ctx.event.groupId, ctx.event.traits, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async alias(...args: AliasParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [to, from, options, callback] = resolveAliasArguments(...args)\n    const segmentEvent = this.eventFactory.alias(\n      to,\n      from,\n      options,\n      this.integrations,\n      pageCtx\n    )\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit('alias', to, from, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async screen(...args: PageParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [category, page, properties, options, callback] =\n      resolvePageArguments(...args)\n\n    const segmentEvent = this.eventFactory.screen(\n      category,\n      page,\n      properties,\n      options,\n      this.integrations,\n      pageCtx\n    )\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit(\n        'screen',\n        category,\n        page,\n        ctx.event.properties,\n        ctx.event.options\n      )\n      return ctx\n    })\n  }\n\n  async trackClick(...args: LinkArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackLink(...args: LinkArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackSubmit(...args: FormArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async trackForm(...args: FormArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async register(...plugins: Plugin[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const registrations = plugins.map((xt) =>\n      this.queue.register(ctx, xt, this)\n    )\n    await Promise.all(registrations)\n\n    return ctx\n  }\n\n  async deregister(...plugins: string[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const deregistrations = plugins.map((pl) => {\n      const plugin = this.queue.plugins.find((p) => p.name === pl)\n      if (plugin) {\n        return this.queue.deregister(ctx, plugin, this)\n      } else {\n        ctx.log('warn', `plugin ${pl} not found`)\n      }\n    })\n\n    await Promise.all(deregistrations)\n\n    return ctx\n  }\n\n  debug(toggle: boolean): Analytics {\n    // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n    if (toggle === false && localStorage.getItem('debug')) {\n      localStorage.removeItem('debug')\n    }\n    this._debug = toggle\n    return this\n  }\n\n  reset(): void {\n    this._user.reset()\n    this._group.reset()\n    this.emit('reset')\n  }\n\n  timeout(timeout: number): void {\n    this.settings.timeout = timeout\n  }\n\n  private async _dispatch(\n    event: SegmentEvent,\n    callback?: Callback\n  ): Promise<DispatchedEvent> {\n    const ctx = new Context(event)\n    if (isOffline() && !this.options.retryQueue) {\n      return ctx\n    }\n    return dispatch(ctx, this.queue, this, {\n      callback,\n      debug: this._debug,\n      timeout: this.settings.timeout,\n    })\n  }\n\n  async addSourceMiddleware(fn: MiddlewareFunction): Promise<Analytics> {\n    await this.queue.criticalTasks.run(async () => {\n      const { sourceMiddlewarePlugin } = await import(\n        /* webpackChunkName: \"middleware\" */ '../../plugins/middleware'\n      )\n\n      const integrations: Record<string, boolean> = {}\n      this.queue.plugins.forEach((plugin) => {\n        if (plugin.type === 'destination') {\n          return (integrations[plugin.name] = true)\n        }\n      })\n\n      const plugin = sourceMiddlewarePlugin(fn, integrations)\n      await this.register(plugin)\n    })\n\n    return this\n  }\n\n  /* TODO: This does not have to return a promise? */\n  addDestinationMiddleware(\n    integrationName: string,\n    ...middlewares: DestinationMiddlewareFunction[]\n  ): Promise<Analytics> {\n    this.queue.plugins\n      .filter(isDestinationPluginWithAddMiddleware)\n      .forEach((p) => {\n        if (\n          integrationName === '*' ||\n          p.name.toLowerCase() === integrationName.toLowerCase()\n        ) {\n          p.addMiddleware(...middlewares)\n        }\n      })\n\n    return Promise.resolve(this)\n  }\n\n  setAnonymousId(id?: string): ID {\n    return this._user.anonymousId(id)\n  }\n\n  async queryString(query: string): Promise<Context[]> {\n    if (this.options.useQueryString === false) {\n      return []\n    }\n\n    const { queryString } = await import(\n      /* webpackChunkName: \"queryString\" */ '../query-string'\n    )\n    return queryString(this, query)\n  }\n\n  /**\n   * @deprecated This function does not register a destination plugin.\n   *\n   * Instantiates a legacy Analytics.js destination.\n   *\n   * This function does not register the destination as an Analytics.JS plugin,\n   * all the it does it to invoke the factory function back.\n   */\n  use(legacyPluginFactory: (analytics: Analytics) => void): Analytics {\n    legacyPluginFactory(this)\n    return this\n  }\n\n  async ready(\n    callback: Function = (res: Promise<unknown>[]): Promise<unknown>[] => res\n  ): Promise<unknown> {\n    return Promise.all(\n      this.queue.plugins.map((i) => (i.ready ? i.ready() : Promise.resolve()))\n    ).then((res) => {\n      callback(res)\n      return res\n    })\n  }\n\n  // analytics-classic api\n\n  noConflict(): Analytics {\n    console.warn(deprecationWarning)\n    setGlobalAnalytics(_analytics ?? this)\n    return this\n  }\n\n  normalize(msg: SegmentEvent): SegmentEvent {\n    console.warn(deprecationWarning)\n    return this.eventFactory.normalize(msg)\n  }\n\n  get failedInitializations(): string[] {\n    console.warn(deprecationWarning)\n    return this.queue.failedInitializations\n  }\n\n  get VERSION(): string {\n    return version\n  }\n\n  /* @deprecated - noop */\n  async initialize(\n    _settings?: AnalyticsSettings,\n    _options?: InitOptions\n  ): Promise<Analytics> {\n    console.warn(deprecationWarning)\n    return Promise.resolve(this)\n  }\n\n  init = this.initialize.bind(this)\n\n  async pageview(url: string): Promise<Analytics> {\n    console.warn(deprecationWarning)\n    await this.page({ path: url })\n    return this\n  }\n\n  get plugins() {\n    console.warn(deprecationWarning)\n    // @ts-expect-error\n    return this._plugins ?? {}\n  }\n\n  get Integrations() {\n    console.warn(deprecationWarning)\n    const integrations = this.queue.plugins\n      .filter((plugin) => plugin.type === 'destination')\n      .reduce((acc, plugin) => {\n        const name = `${plugin.name\n          .toLowerCase()\n          .replace('.', '')\n          .split(' ')\n          .join('-')}Integration`\n\n        // @ts-expect-error\n        const integration = window[name] as\n          | (LegacyIntegration & { Integration?: LegacyIntegration })\n          | undefined\n\n        if (!integration) {\n          return acc\n        }\n\n        const nested = integration.Integration // hack - Google Analytics function resides in the \"Integration\" field\n        if (nested) {\n          acc[plugin.name] = nested\n          return acc\n        }\n\n        acc[plugin.name] = integration as LegacyIntegration\n        return acc\n      }, {} as Record<string, LegacyIntegration>)\n\n    return integrations\n  }\n\n  log = _stub\n  addIntegrationMiddleware = _stub\n  listeners = _stub\n  addEventListener = _stub\n  removeAllListeners = _stub\n  removeListener = _stub\n  removeEventListener = _stub\n  hasListeners = _stub\n  add = _stub\n  addIntegration = _stub\n\n  // snippet function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  push(args: any[]) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const an = this as any\n    const method = args.shift()\n    if (method) {\n      if (!an[method]) return\n    }\n    an[method].apply(this, args)\n  }\n}\n\n/**\n * @returns a no-op analytics instance that does not create cookies or localstorage, or send any events to segment.\n */\nexport class NullAnalytics extends Analytics {\n  constructor() {\n    super({ writeKey: '' }, { disableClientPersistence: true })\n    this.initialized = true\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}