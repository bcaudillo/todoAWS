{"ast":null,"code":"import { __assign } from \"tslib\";\nimport jar from 'js-cookie';\nimport { tld } from '../user/tld';\nvar ONE_YEAR = 365;\n/**\n * Data storage using browser cookies\n */\nvar CookieStorage = /** @class */function () {\n  function CookieStorage(options) {\n    if (options === void 0) {\n      options = CookieStorage.defaults;\n    }\n    this.options = __assign(__assign({}, CookieStorage.defaults), options);\n  }\n  Object.defineProperty(CookieStorage, \"defaults\", {\n    get: function () {\n      return {\n        maxage: ONE_YEAR,\n        domain: tld(window.location.href),\n        path: '/',\n        sameSite: 'Lax'\n      };\n    },\n    enumerable: false,\n    configurable: true\n  });\n  CookieStorage.prototype.opts = function () {\n    return {\n      sameSite: this.options.sameSite,\n      expires: this.options.maxage,\n      domain: this.options.domain,\n      path: this.options.path,\n      secure: this.options.secure\n    };\n  };\n  CookieStorage.prototype.get = function (key) {\n    var _a;\n    try {\n      var value = jar.get(key);\n      if (value === undefined || value === null) {\n        return null;\n      }\n      try {\n        return (_a = JSON.parse(value)) !== null && _a !== void 0 ? _a : null;\n      } catch (e) {\n        return value !== null && value !== void 0 ? value : null;\n      }\n    } catch (e) {\n      return null;\n    }\n  };\n  CookieStorage.prototype.set = function (key, value) {\n    if (typeof value === 'string') {\n      jar.set(key, value, this.opts());\n    } else if (value === null) {\n      jar.remove(key, this.opts());\n    } else {\n      jar.set(key, JSON.stringify(value), this.opts());\n    }\n  };\n  CookieStorage.prototype.remove = function (key) {\n    return jar.remove(key, this.opts());\n  };\n  return CookieStorage;\n}();\nexport { CookieStorage };","map":{"version":3,"names":["jar","tld","ONE_YEAR","CookieStorage","options","defaults","__assign","Object","defineProperty","get","maxage","domain","window","location","href","path","sameSite","prototype","opts","expires","secure","key","value","undefined","_a","JSON","parse","e","set","remove","stringify"],"sources":["/Users/bcaudillo/Desktop/Projects/todo/node_modules/@segment/analytics-next/src/core/storage/cookieStorage.ts"],"sourcesContent":["import { Store, StorageObject } from './types'\nimport jar from 'js-cookie'\nimport { tld } from '../user/tld'\n\nconst ONE_YEAR = 365\n\nexport interface CookieOptions {\n  maxage?: number\n  domain?: string\n  path?: string\n  secure?: boolean\n  sameSite?: string\n}\n\n/**\n * Data storage using browser cookies\n */\nexport class CookieStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  static get defaults(): CookieOptions {\n    return {\n      maxage: ONE_YEAR,\n      domain: tld(window.location.href),\n      path: '/',\n      sameSite: 'Lax',\n    }\n  }\n\n  private options: Required<CookieOptions>\n\n  constructor(options: CookieOptions = CookieStorage.defaults) {\n    this.options = {\n      ...CookieStorage.defaults,\n      ...options,\n    } as Required<CookieOptions>\n  }\n\n  private opts(): jar.CookieAttributes {\n    return {\n      sameSite: this.options.sameSite as jar.CookieAttributes['sameSite'],\n      expires: this.options.maxage,\n      domain: this.options.domain,\n      path: this.options.path,\n      secure: this.options.secure,\n    }\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    try {\n      const value = jar.get(key)\n\n      if (value === undefined || value === null) {\n        return null\n      }\n\n      try {\n        return JSON.parse(value) ?? null\n      } catch (e) {\n        return (value ?? null) as unknown as Data[K] | null\n      }\n    } catch (e) {\n      return null\n    }\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    if (typeof value === 'string') {\n      jar.set(key, value, this.opts())\n    } else if (value === null) {\n      jar.remove(key, this.opts())\n    } else {\n      jar.set(key, JSON.stringify(value), this.opts())\n    }\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    return jar.remove(key, this.opts())\n  }\n}\n"],"mappings":";AACA,OAAOA,GAAG,MAAM,WAAW;AAC3B,SAASC,GAAG,QAAQ,aAAa;AAEjC,IAAMC,QAAQ,GAAG,GAAG;AAUpB;;;AAGA,IAAAC,aAAA;EAcE,SAAAA,cAAYC,OAA+C;IAA/C,IAAAA,OAAA;MAAAA,OAAA,GAAyBD,aAAa,CAACE,QAAQ;IAAA;IACzD,IAAI,CAACD,OAAO,GAAGE,QAAA,CAAAA,QAAA,KACVH,aAAa,CAACE,QAAQ,GACtBD,OAAO,CACgB;EAC9B;EAhBAG,MAAA,CAAAC,cAAA,CAAWL,aAAA,YAAQ;SAAnB,SAAAM,CAAA;MACE,OAAO;QACLC,MAAM,EAAER,QAAQ;QAChBS,MAAM,EAAEV,GAAG,CAACW,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAC;QACjCC,IAAI,EAAE,GAAG;QACTC,QAAQ,EAAE;OACX;IACH,CAAC;;;;EAWOb,aAAA,CAAAc,SAAA,CAAAC,IAAI,GAAZ;IACE,OAAO;MACLF,QAAQ,EAAE,IAAI,CAACZ,OAAO,CAACY,QAA4C;MACnEG,OAAO,EAAE,IAAI,CAACf,OAAO,CAACM,MAAM;MAC5BC,MAAM,EAAE,IAAI,CAACP,OAAO,CAACO,MAAM;MAC3BI,IAAI,EAAE,IAAI,CAACX,OAAO,CAACW,IAAI;MACvBK,MAAM,EAAE,IAAI,CAAChB,OAAO,CAACgB;KACtB;EACH,CAAC;EAEDjB,aAAA,CAAAc,SAAA,CAAAR,GAAG,GAAH,UAA0BY,GAAM;;IAC9B,IAAI;MACF,IAAMC,KAAK,GAAGtB,GAAG,CAACS,GAAG,CAACY,GAAG,CAAC;MAE1B,IAAIC,KAAK,KAAKC,SAAS,IAAID,KAAK,KAAK,IAAI,EAAE;QACzC,OAAO,IAAI;;MAGb,IAAI;QACF,OAAO,CAAAE,EAAA,GAAAC,IAAI,CAACC,KAAK,CAACJ,KAAK,CAAC,cAAAE,EAAA,cAAAA,EAAA,GAAI,IAAI;OACjC,CAAC,OAAOG,CAAC,EAAE;QACV,OAAQL,KAAK,aAALA,KAAK,cAALA,KAAK,GAAI,IAAI;;KAExB,CAAC,OAAOK,CAAC,EAAE;MACV,OAAO,IAAI;;EAEf,CAAC;EAEDxB,aAAA,CAAAc,SAAA,CAAAW,GAAG,GAAH,UAA0BP,GAAM,EAAEC,KAAqB;IACrD,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;MAC7BtB,GAAG,CAAC4B,GAAG,CAACP,GAAG,EAAEC,KAAK,EAAE,IAAI,CAACJ,IAAI,EAAE,CAAC;KACjC,MAAM,IAAII,KAAK,KAAK,IAAI,EAAE;MACzBtB,GAAG,CAAC6B,MAAM,CAACR,GAAG,EAAE,IAAI,CAACH,IAAI,EAAE,CAAC;KAC7B,MAAM;MACLlB,GAAG,CAAC4B,GAAG,CAACP,GAAG,EAAEI,IAAI,CAACK,SAAS,CAACR,KAAK,CAAC,EAAE,IAAI,CAACJ,IAAI,EAAE,CAAC;;EAEpD,CAAC;EAEDf,aAAA,CAAAc,SAAA,CAAAY,MAAM,GAAN,UAA6BR,GAAM;IACjC,OAAOrB,GAAG,CAAC6B,MAAM,CAACR,GAAG,EAAE,IAAI,CAACH,IAAI,EAAE,CAAC;EACrC,CAAC;EACH,OAAAf,aAAC;AAAD,CAAC,CA9DD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}