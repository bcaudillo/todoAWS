{"ast":null,"code":"import { pickPrefix } from './pickPrefix';\nimport { gracefulDecodeURIComponent } from './gracefulDecodeURIComponent';\nimport { isPlainObject } from '@segment/analytics-core';\nexport function queryString(analytics, query) {\n  var a = document.createElement('a');\n  a.href = query;\n  var parsed = a.search.slice(1);\n  var params = parsed.split('&').reduce(function (acc, str) {\n    var _a = str.split('='),\n      k = _a[0],\n      v = _a[1];\n    acc[k] = gracefulDecodeURIComponent(v);\n    return acc;\n  }, {});\n  var calls = [];\n  var ajs_uid = params.ajs_uid,\n    ajs_event = params.ajs_event,\n    ajs_aid = params.ajs_aid;\n  var _a = isPlainObject(analytics.options.useQueryString) ? analytics.options.useQueryString : {},\n    _b = _a.aid,\n    aidPattern = _b === void 0 ? /.+/ : _b,\n    _c = _a.uid,\n    uidPattern = _c === void 0 ? /.+/ : _c;\n  if (ajs_aid) {\n    var anonId = Array.isArray(params.ajs_aid) ? params.ajs_aid[0] : params.ajs_aid;\n    if (aidPattern.test(anonId)) {\n      analytics.setAnonymousId(anonId);\n    }\n  }\n  if (ajs_uid) {\n    var uid = Array.isArray(params.ajs_uid) ? params.ajs_uid[0] : params.ajs_uid;\n    if (uidPattern.test(uid)) {\n      var traits = pickPrefix('ajs_trait_', params);\n      calls.push(analytics.identify(uid, traits));\n    }\n  }\n  if (ajs_event) {\n    var event_1 = Array.isArray(params.ajs_event) ? params.ajs_event[0] : params.ajs_event;\n    var props = pickPrefix('ajs_prop_', params);\n    calls.push(analytics.track(event_1, props));\n  }\n  return Promise.all(calls);\n}","map":{"version":3,"names":["pickPrefix","gracefulDecodeURIComponent","isPlainObject","queryString","analytics","query","a","document","createElement","href","parsed","search","slice","params","split","reduce","acc","str","_a","k","v","calls","ajs_uid","ajs_event","ajs_aid","options","useQueryString","_b","aid","aidPattern","_c","uid","uidPattern","anonId","Array","isArray","test","setAnonymousId","traits","push","identify","event_1","props","track","Promise","all"],"sources":["/Users/bcaudillo/Desktop/Projects/todo/node_modules/@segment/analytics-next/src/core/query-string/index.ts"],"sourcesContent":["import { pickPrefix } from './pickPrefix'\nimport { gracefulDecodeURIComponent } from './gracefulDecodeURIComponent'\nimport { Analytics } from '../analytics'\nimport { Context } from '../context'\nimport { isPlainObject } from '@segment/analytics-core'\n\nexport interface QueryStringParams {\n  [key: string]: string | null\n}\n\nexport function queryString(\n  analytics: Analytics,\n  query: string\n): Promise<Context[]> {\n  const a = document.createElement('a')\n  a.href = query\n  const parsed = a.search.slice(1)\n  const params = parsed.split('&').reduce((acc: QueryStringParams, str) => {\n    const [k, v] = str.split('=')\n    acc[k] = gracefulDecodeURIComponent(v)\n    return acc\n  }, {})\n\n  const calls = []\n\n  const { ajs_uid, ajs_event, ajs_aid } = params\n  const { aid: aidPattern = /.+/, uid: uidPattern = /.+/ } = isPlainObject(\n    analytics.options.useQueryString\n  )\n    ? analytics.options.useQueryString\n    : {}\n\n  if (ajs_aid) {\n    const anonId = Array.isArray(params.ajs_aid)\n      ? params.ajs_aid[0]\n      : params.ajs_aid\n\n    if (aidPattern.test(anonId)) {\n      analytics.setAnonymousId(anonId)\n    }\n  }\n\n  if (ajs_uid) {\n    const uid = Array.isArray(params.ajs_uid)\n      ? params.ajs_uid[0]\n      : params.ajs_uid\n\n    if (uidPattern.test(uid)) {\n      const traits = pickPrefix('ajs_trait_', params)\n\n      calls.push(analytics.identify(uid, traits))\n    }\n  }\n\n  if (ajs_event) {\n    const event = Array.isArray(params.ajs_event)\n      ? params.ajs_event[0]\n      : params.ajs_event\n    const props = pickPrefix('ajs_prop_', params)\n    calls.push(analytics.track(event, props))\n  }\n\n  return Promise.all(calls)\n}\n"],"mappings":"AAAA,SAASA,UAAU,QAAQ,cAAc;AACzC,SAASC,0BAA0B,QAAQ,8BAA8B;AAGzE,SAASC,aAAa,QAAQ,yBAAyB;AAMvD,OAAM,SAAUC,WAAWA,CACzBC,SAAoB,EACpBC,KAAa;EAEb,IAAMC,CAAC,GAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;EACrCF,CAAC,CAACG,IAAI,GAAGJ,KAAK;EACd,IAAMK,MAAM,GAAGJ,CAAC,CAACK,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC;EAChC,IAAMC,MAAM,GAAGH,MAAM,CAACI,KAAK,CAAC,GAAG,CAAC,CAACC,MAAM,CAAC,UAACC,GAAsB,EAAEC,GAAG;IAC5D,IAAAC,EAAA,GAASD,GAAG,CAACH,KAAK,CAAC,GAAG,CAAC;MAAtBK,CAAC,GAAAD,EAAA;MAAEE,CAAC,GAAAF,EAAA,GAAkB;IAC7BF,GAAG,CAACG,CAAC,CAAC,GAAGlB,0BAA0B,CAACmB,CAAC,CAAC;IACtC,OAAOJ,GAAG;EACZ,CAAC,EAAE,EAAE,CAAC;EAEN,IAAMK,KAAK,GAAG,EAAE;EAER,IAAAC,OAAO,GAAyBT,MAAM,CAAAS,OAA/B;IAAEC,SAAS,GAAcV,MAAM,CAAAU,SAApB;IAAEC,OAAO,GAAKX,MAAM,CAAAW,OAAX;EAC7B,IAAAN,EAAA,GAAqDhB,aAAa,CACtEE,SAAS,CAACqB,OAAO,CAACC,cAAc,CACjC,GACGtB,SAAS,CAACqB,OAAO,CAACC,cAAc,GAChC,EAAE;IAJEC,EAAA,GAAAT,EAAA,CAAAU,GAAsB;IAAjBC,UAAU,GAAAF,EAAA,cAAG,IAAI,GAAAA,EAAA;IAAEG,EAAA,GAAAZ,EAAA,CAAAa,GAAsB;IAAjBC,UAAU,GAAAF,EAAA,cAAG,IAAI,GAAAA,EAIhD;EAEN,IAAIN,OAAO,EAAE;IACX,IAAMS,MAAM,GAAGC,KAAK,CAACC,OAAO,CAACtB,MAAM,CAACW,OAAO,CAAC,GACxCX,MAAM,CAACW,OAAO,CAAC,CAAC,CAAC,GACjBX,MAAM,CAACW,OAAO;IAElB,IAAIK,UAAU,CAACO,IAAI,CAACH,MAAM,CAAC,EAAE;MAC3B7B,SAAS,CAACiC,cAAc,CAACJ,MAAM,CAAC;;;EAIpC,IAAIX,OAAO,EAAE;IACX,IAAMS,GAAG,GAAGG,KAAK,CAACC,OAAO,CAACtB,MAAM,CAACS,OAAO,CAAC,GACrCT,MAAM,CAACS,OAAO,CAAC,CAAC,CAAC,GACjBT,MAAM,CAACS,OAAO;IAElB,IAAIU,UAAU,CAACI,IAAI,CAACL,GAAG,CAAC,EAAE;MACxB,IAAMO,MAAM,GAAGtC,UAAU,CAAC,YAAY,EAAEa,MAAM,CAAC;MAE/CQ,KAAK,CAACkB,IAAI,CAACnC,SAAS,CAACoC,QAAQ,CAACT,GAAG,EAAEO,MAAM,CAAC,CAAC;;;EAI/C,IAAIf,SAAS,EAAE;IACb,IAAMkB,OAAK,GAAGP,KAAK,CAACC,OAAO,CAACtB,MAAM,CAACU,SAAS,CAAC,GACzCV,MAAM,CAACU,SAAS,CAAC,CAAC,CAAC,GACnBV,MAAM,CAACU,SAAS;IACpB,IAAMmB,KAAK,GAAG1C,UAAU,CAAC,WAAW,EAAEa,MAAM,CAAC;IAC7CQ,KAAK,CAACkB,IAAI,CAACnC,SAAS,CAACuC,KAAK,CAACF,OAAK,EAAEC,KAAK,CAAC,CAAC;;EAG3C,OAAOE,OAAO,CAACC,GAAG,CAACxB,KAAK,CAAC;AAC3B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}