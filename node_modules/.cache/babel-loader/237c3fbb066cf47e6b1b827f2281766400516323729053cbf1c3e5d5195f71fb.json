{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { v4 as uuid } from '@lukeed/uuid';\nimport autoBind from '../../lib/bind-all';\nimport { UniversalStorage, MemoryStorage, StoreType, applyCookieOptions, initializeStorages, isArrayOfStoreType } from '../storage';\nvar defaults = {\n  persist: true,\n  cookie: {\n    key: 'ajs_user_id',\n    oldKey: 'ajs_user'\n  },\n  localStorage: {\n    key: 'ajs_user_traits'\n  }\n};\nvar User = /** @class */function () {\n  function User(options, cookieOptions) {\n    if (options === void 0) {\n      options = defaults;\n    }\n    var _this = this;\n    var _a, _b, _c, _d;\n    this.options = {};\n    this.id = function (id) {\n      if (_this.options.disable) {\n        return null;\n      }\n      var prevId = _this.identityStore.getAndSync(_this.idKey);\n      if (id !== undefined) {\n        _this.identityStore.set(_this.idKey, id);\n        var changingIdentity = id !== prevId && prevId !== null && id !== null;\n        if (changingIdentity) {\n          _this.anonymousId(null);\n        }\n      }\n      var retId = _this.identityStore.getAndSync(_this.idKey);\n      if (retId) return retId;\n      var retLeg = _this.legacyUserStore.get(defaults.cookie.oldKey);\n      return retLeg ? typeof retLeg === 'object' ? retLeg.id : retLeg : null;\n    };\n    this.anonymousId = function (id) {\n      var _a, _b;\n      if (_this.options.disable) {\n        return null;\n      }\n      if (id === undefined) {\n        var val = (_a = _this.identityStore.getAndSync(_this.anonKey)) !== null && _a !== void 0 ? _a : (_b = _this.legacySIO()) === null || _b === void 0 ? void 0 : _b[0];\n        if (val) {\n          return val;\n        }\n      }\n      if (id === null) {\n        _this.identityStore.set(_this.anonKey, null);\n        return _this.identityStore.getAndSync(_this.anonKey);\n      }\n      _this.identityStore.set(_this.anonKey, id !== null && id !== void 0 ? id : uuid());\n      return _this.identityStore.getAndSync(_this.anonKey);\n    };\n    this.traits = function (traits) {\n      var _a;\n      if (_this.options.disable) {\n        return;\n      }\n      if (traits === null) {\n        traits = {};\n      }\n      if (traits) {\n        _this.traitsStore.set(_this.traitsKey, traits !== null && traits !== void 0 ? traits : {});\n      }\n      return (_a = _this.traitsStore.get(_this.traitsKey)) !== null && _a !== void 0 ? _a : {};\n    };\n    this.options = __assign(__assign({}, defaults), options);\n    this.cookieOptions = cookieOptions;\n    this.idKey = (_b = (_a = options.cookie) === null || _a === void 0 ? void 0 : _a.key) !== null && _b !== void 0 ? _b : defaults.cookie.key;\n    this.traitsKey = (_d = (_c = options.localStorage) === null || _c === void 0 ? void 0 : _c.key) !== null && _d !== void 0 ? _d : defaults.localStorage.key;\n    this.anonKey = 'ajs_anonymous_id';\n    this.identityStore = this.createStorage(this.options, cookieOptions);\n    // using only cookies for legacy user store\n    this.legacyUserStore = this.createStorage(this.options, cookieOptions, function (s) {\n      return s === StoreType.Cookie;\n    });\n    // using only localStorage / memory for traits store\n    this.traitsStore = this.createStorage(this.options, cookieOptions, function (s) {\n      return s !== StoreType.Cookie;\n    });\n    var legacyUser = this.legacyUserStore.get(defaults.cookie.oldKey);\n    if (legacyUser && typeof legacyUser === 'object') {\n      legacyUser.id && this.id(legacyUser.id);\n      legacyUser.traits && this.traits(legacyUser.traits);\n    }\n    autoBind(this);\n  }\n  User.prototype.legacySIO = function () {\n    var val = this.legacyUserStore.get('_sio');\n    if (!val) {\n      return null;\n    }\n    var _a = val.split('----'),\n      anon = _a[0],\n      user = _a[1];\n    return [anon, user];\n  };\n  User.prototype.identify = function (id, traits) {\n    if (this.options.disable) {\n      return;\n    }\n    traits = traits !== null && traits !== void 0 ? traits : {};\n    var currentId = this.id();\n    if (currentId === null || currentId === id) {\n      traits = __assign(__assign({}, this.traits()), traits);\n    }\n    if (id) {\n      this.id(id);\n    }\n    this.traits(traits);\n  };\n  User.prototype.logout = function () {\n    this.anonymousId(null);\n    this.id(null);\n    this.traits({});\n  };\n  User.prototype.reset = function () {\n    this.logout();\n    this.identityStore.clear(this.idKey);\n    this.identityStore.clear(this.anonKey);\n    this.traitsStore.clear(this.traitsKey);\n  };\n  User.prototype.load = function () {\n    return new User(this.options, this.cookieOptions);\n  };\n  User.prototype.save = function () {\n    return true;\n  };\n  /**\n   * Creates the right storage system applying all the user options, cookie options and particular filters\n   * @param options UserOptions\n   * @param cookieOpts CookieOptions\n   * @param filterStores filter function to apply to any StoreTypes (skipped if options specify using a custom storage)\n   * @returns a Storage object\n   */\n  User.prototype.createStorage = function (options, cookieOpts, filterStores) {\n    var stores = [StoreType.LocalStorage, StoreType.Cookie, StoreType.Memory];\n    // If disabled we won't have any storage functionality\n    if (options.disable) {\n      return new UniversalStorage([]);\n    }\n    // If persistance is disabled we will always fallback to Memory Storage\n    if (!options.persist) {\n      return new UniversalStorage([new MemoryStorage()]);\n    }\n    if (options.storage !== undefined && options.storage !== null) {\n      if (isArrayOfStoreType(options.storage)) {\n        // If the user only specified order of stores we will still apply filters and transformations e.g. not using localStorage if localStorageFallbackDisabled\n        stores = options.storage.stores;\n      }\n    }\n    // Disable LocalStorage\n    if (options.localStorageFallbackDisabled) {\n      stores = stores.filter(function (s) {\n        return s !== StoreType.LocalStorage;\n      });\n    }\n    // Apply Additional filters\n    if (filterStores) {\n      stores = stores.filter(filterStores);\n    }\n    return new UniversalStorage(initializeStorages(applyCookieOptions(stores, cookieOpts)));\n  };\n  User.defaults = defaults;\n  return User;\n}();\nexport { User };\nvar groupDefaults = {\n  persist: true,\n  cookie: {\n    key: 'ajs_group_id'\n  },\n  localStorage: {\n    key: 'ajs_group_properties'\n  }\n};\nvar Group = /** @class */function (_super) {\n  __extends(Group, _super);\n  function Group(options, cookie) {\n    if (options === void 0) {\n      options = groupDefaults;\n    }\n    var _this = _super.call(this, __assign(__assign({}, groupDefaults), options), cookie) || this;\n    _this.anonymousId = function (_id) {\n      return undefined;\n    };\n    autoBind(_this);\n    return _this;\n  }\n  return Group;\n}(User);\nexport { Group };","map":{"version":3,"names":["v4","uuid","autoBind","UniversalStorage","MemoryStorage","StoreType","applyCookieOptions","initializeStorages","isArrayOfStoreType","defaults","persist","cookie","key","oldKey","localStorage","User","options","cookieOptions","_this","id","disable","prevId","identityStore","getAndSync","idKey","undefined","set","changingIdentity","anonymousId","retId","retLeg","legacyUserStore","get","val","_a","anonKey","_b","legacySIO","traits","traitsStore","traitsKey","__assign","_d","_c","createStorage","s","Cookie","legacyUser","prototype","split","anon","user","identify","currentId","logout","reset","clear","load","save","cookieOpts","filterStores","stores","LocalStorage","Memory","storage","localStorageFallbackDisabled","filter","groupDefaults","Group","_super","__extends","call","_id"],"sources":["/Users/bcaudillo/Desktop/Projects/todo/node_modules/@segment/analytics-next/src/core/user/index.ts"],"sourcesContent":["import { v4 as uuid } from '@lukeed/uuid'\nimport autoBind from '../../lib/bind-all'\nimport { Traits } from '../events'\nimport {\n  CookieOptions,\n  UniversalStorage,\n  MemoryStorage,\n  StorageObject,\n  StorageSettings,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\n\nexport type ID = string | null | undefined\n\nexport interface UserOptions {\n  /**\n   * Disables storing any data about the user.\n   */\n  disable?: boolean\n  localStorageFallbackDisabled?: boolean\n  persist?: boolean\n\n  cookie?: {\n    key?: string\n    oldKey?: string\n  }\n\n  localStorage?: {\n    key: string\n  }\n\n  /**\n   * Store priority\n   * @example stores: [StoreType.Cookie, StoreType.Memory]\n   */\n  storage?: StorageSettings\n}\n\nconst defaults = {\n  persist: true,\n  cookie: {\n    key: 'ajs_user_id',\n    oldKey: 'ajs_user',\n  },\n  localStorage: {\n    key: 'ajs_user_traits',\n  },\n}\n\nexport class User {\n  static defaults = defaults\n\n  private idKey: string\n  private traitsKey: string\n  private anonKey: string\n  private cookieOptions?: CookieOptions\n\n  private legacyUserStore: UniversalStorage<{\n    [k: string]:\n      | {\n          id?: string\n          traits?: Traits\n        }\n      | string\n  }>\n  private traitsStore: UniversalStorage<{\n    [k: string]: Traits\n  }>\n\n  private identityStore: UniversalStorage<{\n    [k: string]: string\n  }>\n\n  options: UserOptions = {}\n\n  constructor(options: UserOptions = defaults, cookieOptions?: CookieOptions) {\n    this.options = { ...defaults, ...options }\n    this.cookieOptions = cookieOptions\n\n    this.idKey = options.cookie?.key ?? defaults.cookie.key\n    this.traitsKey = options.localStorage?.key ?? defaults.localStorage.key\n    this.anonKey = 'ajs_anonymous_id'\n\n    this.identityStore = this.createStorage(this.options, cookieOptions)\n\n    // using only cookies for legacy user store\n    this.legacyUserStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s === StoreType.Cookie\n    )\n\n    // using only localStorage / memory for traits store\n    this.traitsStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s !== StoreType.Cookie\n    )\n\n    const legacyUser = this.legacyUserStore.get(defaults.cookie.oldKey)\n    if (legacyUser && typeof legacyUser === 'object') {\n      legacyUser.id && this.id(legacyUser.id)\n      legacyUser.traits && this.traits(legacyUser.traits)\n    }\n    autoBind(this)\n  }\n\n  id = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    const prevId = this.identityStore.getAndSync(this.idKey)\n\n    if (id !== undefined) {\n      this.identityStore.set(this.idKey, id)\n\n      const changingIdentity = id !== prevId && prevId !== null && id !== null\n      if (changingIdentity) {\n        this.anonymousId(null)\n      }\n    }\n\n    const retId = this.identityStore.getAndSync(this.idKey)\n    if (retId) return retId\n\n    const retLeg = this.legacyUserStore.get(defaults.cookie.oldKey)\n    return retLeg ? (typeof retLeg === 'object' ? retLeg.id : retLeg) : null\n  }\n\n  private legacySIO(): [string, string] | null {\n    const val = this.legacyUserStore.get('_sio') as string\n    if (!val) {\n      return null\n    }\n    const [anon, user] = val.split('----')\n    return [anon, user]\n  }\n\n  anonymousId = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    if (id === undefined) {\n      const val =\n        this.identityStore.getAndSync(this.anonKey) ?? this.legacySIO()?.[0]\n\n      if (val) {\n        return val\n      }\n    }\n\n    if (id === null) {\n      this.identityStore.set(this.anonKey, null)\n      return this.identityStore.getAndSync(this.anonKey)\n    }\n\n    this.identityStore.set(this.anonKey, id ?? uuid())\n    return this.identityStore.getAndSync(this.anonKey)\n  }\n\n  traits = (traits?: Traits | null): Traits | undefined => {\n    if (this.options.disable) {\n      return\n    }\n\n    if (traits === null) {\n      traits = {}\n    }\n\n    if (traits) {\n      this.traitsStore.set(this.traitsKey, traits ?? {})\n    }\n\n    return this.traitsStore.get(this.traitsKey) ?? {}\n  }\n\n  identify(id?: ID, traits?: Traits): void {\n    if (this.options.disable) {\n      return\n    }\n\n    traits = traits ?? {}\n    const currentId = this.id()\n\n    if (currentId === null || currentId === id) {\n      traits = {\n        ...this.traits(),\n        ...traits,\n      }\n    }\n\n    if (id) {\n      this.id(id)\n    }\n\n    this.traits(traits)\n  }\n\n  logout(): void {\n    this.anonymousId(null)\n    this.id(null)\n    this.traits({})\n  }\n\n  reset(): void {\n    this.logout()\n    this.identityStore.clear(this.idKey)\n    this.identityStore.clear(this.anonKey)\n    this.traitsStore.clear(this.traitsKey)\n  }\n\n  load(): User {\n    return new User(this.options, this.cookieOptions)\n  }\n\n  save(): boolean {\n    return true\n  }\n\n  /**\n   * Creates the right storage system applying all the user options, cookie options and particular filters\n   * @param options UserOptions\n   * @param cookieOpts CookieOptions\n   * @param filterStores filter function to apply to any StoreTypes (skipped if options specify using a custom storage)\n   * @returns a Storage object\n   */\n  private createStorage<T extends StorageObject = StorageObject>(\n    options: UserOptions,\n    cookieOpts?: CookieOptions,\n    filterStores?: (value: StoreType) => boolean\n  ): UniversalStorage<T> {\n    let stores: StoreType[] = [\n      StoreType.LocalStorage,\n      StoreType.Cookie,\n      StoreType.Memory,\n    ]\n\n    // If disabled we won't have any storage functionality\n    if (options.disable) {\n      return new UniversalStorage<T>([])\n    }\n\n    // If persistance is disabled we will always fallback to Memory Storage\n    if (!options.persist) {\n      return new UniversalStorage<T>([new MemoryStorage<T>()])\n    }\n\n    if (options.storage !== undefined && options.storage !== null) {\n      if (isArrayOfStoreType(options.storage)) {\n        // If the user only specified order of stores we will still apply filters and transformations e.g. not using localStorage if localStorageFallbackDisabled\n        stores = options.storage.stores\n      }\n    }\n\n    // Disable LocalStorage\n    if (options.localStorageFallbackDisabled) {\n      stores = stores.filter((s) => s !== StoreType.LocalStorage)\n    }\n\n    // Apply Additional filters\n    if (filterStores) {\n      stores = stores.filter(filterStores)\n    }\n\n    return new UniversalStorage(\n      initializeStorages(applyCookieOptions(stores, cookieOpts))\n    )\n  }\n}\n\nconst groupDefaults: UserOptions = {\n  persist: true,\n  cookie: {\n    key: 'ajs_group_id',\n  },\n  localStorage: {\n    key: 'ajs_group_properties',\n  },\n}\n\nexport class Group extends User {\n  constructor(options: UserOptions = groupDefaults, cookie?: CookieOptions) {\n    super({ ...groupDefaults, ...options }, cookie)\n    autoBind(this)\n  }\n\n  anonymousId = (_id?: ID): ID => {\n    return undefined\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}