{"ast":null,"code":"import * as tsub from '@segment/tsub';\nexport var tsubMiddleware = function (rules) {\n  return function (_a) {\n    var payload = _a.payload,\n      integration = _a.integration,\n      next = _a.next;\n    var store = new tsub.Store(rules);\n    var rulesToApply = store.getRulesByDestinationName(integration);\n    rulesToApply.forEach(function (rule) {\n      var matchers = rule.matchers,\n        transformers = rule.transformers;\n      for (var i = 0; i < matchers.length; i++) {\n        if (tsub.matches(payload.obj, matchers[i])) {\n          payload.obj = tsub.transform(payload.obj, transformers[i]);\n          if (payload.obj === null) {\n            return next(null);\n          }\n        }\n      }\n    });\n    next(payload);\n  };\n};","map":{"version":3,"names":["tsub","tsubMiddleware","rules","_a","payload","integration","next","store","Store","rulesToApply","getRulesByDestinationName","forEach","rule","matchers","transformers","i","length","matches","obj","transform"],"sources":["/Users/bcaudillo/Desktop/Projects/todo/node_modules/@segment/analytics-next/src/plugins/routing-middleware/index.ts"],"sourcesContent":["import * as tsub from '@segment/tsub'\nimport { Matcher, Rule } from '@segment/tsub/dist/store'\nimport { DestinationMiddlewareFunction } from '../middleware'\n\n// TODO: update tsub definition\ntype RoutingRuleMatcher = Matcher & {\n  config?: {\n    expr: string\n  }\n}\n\nexport type RoutingRule = Rule & {\n  matchers: RoutingRuleMatcher[]\n}\n\nexport const tsubMiddleware =\n  (rules: RoutingRule[]): DestinationMiddlewareFunction =>\n  ({ payload, integration, next }): void => {\n    const store = new tsub.Store(rules)\n    const rulesToApply = store.getRulesByDestinationName(integration)\n\n    rulesToApply.forEach((rule) => {\n      const { matchers, transformers } = rule\n\n      for (let i = 0; i < matchers.length; i++) {\n        if (tsub.matches(payload.obj, matchers[i])) {\n          payload.obj = tsub.transform(payload.obj, transformers[i])\n\n          if (payload.obj === null) {\n            return next(null)\n          }\n        }\n      }\n    })\n\n    next(payload)\n  }\n"],"mappings":"AAAA,OAAO,KAAKA,IAAI,MAAM,eAAe;AAerC,OAAO,IAAMC,cAAc,GACzB,SAAAA,CAACC,KAAoB;EACrB,iBAACC,EAA8B;QAA5BC,OAAO,GAAAD,EAAA,CAAAC,OAAA;MAAEC,WAAW,GAAAF,EAAA,CAAAE,WAAA;MAAEC,IAAI,GAAAH,EAAA,CAAAG,IAAA;IAC3B,IAAMC,KAAK,GAAG,IAAIP,IAAI,CAACQ,KAAK,CAACN,KAAK,CAAC;IACnC,IAAMO,YAAY,GAAGF,KAAK,CAACG,yBAAyB,CAACL,WAAW,CAAC;IAEjEI,YAAY,CAACE,OAAO,CAAC,UAACC,IAAI;MAChB,IAAAC,QAAQ,GAAmBD,IAAI,CAAAC,QAAvB;QAAEC,YAAY,GAAKF,IAAI,CAAAE,YAAT;MAE9B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,QAAQ,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;QACxC,IAAIf,IAAI,CAACiB,OAAO,CAACb,OAAO,CAACc,GAAG,EAAEL,QAAQ,CAACE,CAAC,CAAC,CAAC,EAAE;UAC1CX,OAAO,CAACc,GAAG,GAAGlB,IAAI,CAACmB,SAAS,CAACf,OAAO,CAACc,GAAG,EAAEJ,YAAY,CAACC,CAAC,CAAC,CAAC;UAE1D,IAAIX,OAAO,CAACc,GAAG,KAAK,IAAI,EAAE;YACxB,OAAOZ,IAAI,CAAC,IAAI,CAAC;;;;IAIzB,CAAC,CAAC;IAEFA,IAAI,CAACF,OAAO,CAAC;EACf,CAAC;AAnBD,CAmBC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}