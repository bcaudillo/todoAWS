{"ast":null,"code":"import { isThenable } from '../utils/is-thenable';\nexport var createTaskGroup = function () {\n  var taskCompletionPromise;\n  var resolvePromise;\n  var count = 0;\n  return {\n    done: function () {\n      return taskCompletionPromise;\n    },\n    run: function (op) {\n      var returnValue = op();\n      if (isThenable(returnValue)) {\n        if (++count === 1) {\n          taskCompletionPromise = new Promise(function (res) {\n            return resolvePromise = res;\n          });\n        }\n        returnValue.finally(function () {\n          return --count === 0 && resolvePromise();\n        });\n      }\n      return returnValue;\n    }\n  };\n};","map":{"version":3,"names":["isThenable","createTaskGroup","taskCompletionPromise","resolvePromise","count","done","run","op","returnValue","Promise","res","finally"],"sources":["/Users/bcaudillo/Desktop/Projects/todo/node_modules/@segment/analytics-core/src/task/task-group.ts"],"sourcesContent":["import { isThenable } from '../utils/is-thenable'\n\nexport type TaskGroup = {\n  done: () => Promise<void>\n  run: <Operation extends (...args: any[]) => any>(\n    op: Operation\n  ) => ReturnType<Operation>\n}\n\nexport const createTaskGroup = (): TaskGroup => {\n  let taskCompletionPromise: Promise<void>\n  let resolvePromise: () => void\n  let count = 0\n\n  return {\n    done: () => taskCompletionPromise,\n    run: (op) => {\n      const returnValue = op()\n\n      if (isThenable(returnValue)) {\n        if (++count === 1) {\n          taskCompletionPromise = new Promise((res) => (resolvePromise = res))\n        }\n\n        returnValue.finally(() => --count === 0 && resolvePromise())\n      }\n\n      return returnValue\n    },\n  }\n}\n"],"mappings":"AAAA,SAASA,UAAU,QAAQ,sBAAsB;AASjD,OAAO,IAAMC,eAAe,GAAG,SAAAA,CAAA;EAC7B,IAAIC,qBAAoC;EACxC,IAAIC,cAA0B;EAC9B,IAAIC,KAAK,GAAG,CAAC;EAEb,OAAO;IACLC,IAAI,EAAE,SAAAA,CAAA;MAAM,OAAAH,qBAAqB;IAArB,CAAqB;IACjCI,GAAG,EAAE,SAAAA,CAACC,EAAE;MACN,IAAMC,WAAW,GAAGD,EAAE,EAAE;MAExB,IAAIP,UAAU,CAACQ,WAAW,CAAC,EAAE;QAC3B,IAAI,EAAEJ,KAAK,KAAK,CAAC,EAAE;UACjBF,qBAAqB,GAAG,IAAIO,OAAO,CAAC,UAACC,GAAG;YAAK,OAACP,cAAc,GAAGO,GAAG;UAArB,CAAsB,CAAC;;QAGtEF,WAAW,CAACG,OAAO,CAAC;UAAM,SAAEP,KAAK,KAAK,CAAC,IAAID,cAAc,EAAE;QAAjC,CAAiC,CAAC;;MAG9D,OAAOK,WAAW;IACpB;GACD;AACH,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}